<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Multi Isian Elemen & CP Agribisnis Ternak (Tablet/Mobile)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f8fafc; padding: 5vw;}
    .form-box { background: #fff; border-radius: 14px; box-shadow: 0 0 12px #eee; max-width: 99vw; margin: auto; padding: 3vw; }
    select, input, textarea { font-size: 1rem; padding: 8px; margin-top: 6px; border-radius: 8px; border: 1px solid #ddd; }
    input, select, textarea { width: 97%; max-width: 97vw; }
    label { font-weight: bold; margin-top: 18px; display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 22px; }
    th, td { border: 1px solid #cbd5e1; padding: 10px 7px; text-align: left; font-size: 0.98rem;}
    th { background: #f1f5f9; }
    .btn-tambah, .btn-hapus, .btn-cetak { margin: 8px 2px 0 0; font-size: 1rem; border-radius: 10px; padding: 11px 18px; border: none;}
    .btn-tambah { background: #16a34a; color: #fff; }
    .btn-hapus { background: #ef4444; color: #fff; }
    .btn-cetak { background: #06b6d4; color: #fff; float: right; }
    #msg { margin-top:18px; color:#ef4444; font-weight:bold; }
    @media (max-width: 900px) {
      .form-box { padding: 2vw; }
      table, th, td { font-size: 0.95rem; }
      input, select, textarea { font-size: 1rem; }
      .btn-cetak { float:none; width:100%; margin: 15px 0 0 0;}
    }
  </style>
</head>
<body>
<div class="form-box">
  <h2>Multi Isian Elemen & CP<br>Dasar-Dasar Agribisnis Ternak</h2>
  <label>Nama Guru:</label>
  <input id="guru" autocomplete="off" placeholder="Nama Guru">

  <label>Kelas/Semester:</label>
  <input id="kelas" autocomplete="off" placeholder="Kelas/Semester">

  <table id="tbl">
    <thead>
      <tr>
        <th style="width:37px;">No</th>
        <th style="width:36vw;">Elemen</th>
        <th style="width:54vw;">Capaian Pembelajaran</th>
        <th style="width:54vw;">Deskripsi Elemen</th>
        <th style="width:50px;">Aksi</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
  <button class="btn-tambah" type="button" onclick="addRow()">+ Tambah Baris</button>
  <button class="btn-cetak" type="button" id="btnDownload">Download Word</button>
  <div id="msg"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/docx@8.0.4/build/index.umd.min.js"></script>
<script>
const elOpt = [
  "Proses bisnis secara menyeluruh di bidang agribisnis ternak",
  "Perkembangan teknologi produksi & isu-isu global agribisnis ternak",
  "Agripreneur, peluang usaha & profesi di bidang agribisnis ternak",
  "Proses-proses dasar pada agribisnis ternak",
  "Penanganan komoditas peternakan sesuai prosedur K3LH"
];
const cp = [
  "Peserta didik mampu memahami aktivitas pekerjaan secara menyeluruh manajemen produksi bidang agribisnis ternak dengan memperhatikan potensi dan kearifan lokal.",
  "Peserta didik mampu memahami teknologi peternakan, isu-isu global terkait dengan agribisnis dan industri ternak.",
  "Peserta didik mampu memahami profil agripreneur dan peluang bekerja di bidang agribisnis ternak.",
  "Peserta didik mampu memahami konsep, prinsip, dan prosedur peternakan.",
  "Peserta didik mampu memahami pengidentifikasian karakteristik dan penanganan komoditas peternakan dengan menerapkan prinsip dan prosedur K3LH."
];
const desc = [
  "Meliputi aktivitas pekerjaan pada bidang agribisnis ternak, antara lain penerapan K3LH, perencanaan produk, rantai pasok (supply chain), logistik, proses produksi, penggunaan dan perawatan peralatan di bidang agribisnis ternak, serta pengelolaan sumber daya manusia dengan memperhatikan potensi dan kearifan lokal.",
  "Meliputi teknologi peternakan seperti perkembangan bioteknologi, otomatisasi, aplikasi digitalisasi dan internet of things (IoT), serta isu-isu pemanasan global, perubahan iklim, ketersediaan pangan global, regional dan lokal, pertanian berkelanjutan, sistem kelembagaan pada rantai produksi dan pasar, dan limbah dengan prinsip 8R (Rethink, Refuse, Reuse, Refurbish, Repair, Repurpose, Recycle).",
  "Meliputi profil agripreneur yang mampu membaca peluang pasar dan usaha, profesi pemroduksi ternak (petani ternak) dalam rangka menumbuhkan jiwa wirausaha, serta peluang usaha dan peluang bekerja di bidang agribisnis ternak.",
  "Meliputi konsep, prinsip dan prosedur peternakan (pembibitan, pakan, perkandangan, kesehatan ternak, pemeliharaan, pemanenan dan pemasaran).",
  "Meliputi pengidentifikasian karakteristik dan penanganan komoditas peternakan untuk disimpan, dikonsumsi, atau diproses lebih lanjut menjadi produk olahan setengah jadi, atau produk jadi dengan menerapkan prinsip dan prosedur K3LH."
];

let idxBaris = 0;
function makeDropdown(idx, selected) {
  let opt = `<select onchange="isiOtomatis(${idx})"><option value="">--Pilih--</option>`;
  for (let i=0; i<elOpt.length; i++) {
    opt += `<option value="${i}" ${selected==i?"selected":""}>${elOpt[i]}</option>`;
  }
  opt += "</select>";
  return opt;
}
function addRow(val=undefined) {
  idxBaris++;
  const tb = document.getElementById('rows');
  const tr = document.createElement('tr');
  tr.setAttribute('id','row'+idxBaris);
  tr.innerHTML =
    `<td style="text-align:center">${idxBaris}</td>
     <td>${makeDropdown(idxBaris, val)}</td>
     <td><textarea rows="3" readonly style="width:96%;resize:vertical;" id="cp${idxBaris}"></textarea></td>
     <td><textarea rows="3" readonly style="width:96%;resize:vertical;" id="desc${idxBaris}"></textarea></td>
     <td><button class="btn-hapus" type="button" onclick="delRow(${idxBaris})">Hapus</button></td>`;
  tb.appendChild(tr);
}
function isiOtomatis(idx) {
  const sel = document.querySelector(`#row${idx} select`);
  const v = sel.value;
  document.getElementById('cp'+idx).value = v!=="" ? cp[v] : "";
  document.getElementById('desc'+idx).value = v!=="" ? desc[v] : "";
}
function delRow(idx) {
  const r = document.getElementById('row'+idx);
  if (r) r.remove();
}
addRow();

document.getElementById('btnDownload').onclick = async function cetakWord() {
  const msg = document.getElementById('msg');
  msg.innerHTML = "";
  try {
    const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, AlignmentType } = window.docx;
    const guru = document.getElementById('guru').value;
    const kelas = document.getElementById('kelas').value;
    const rows = document.querySelectorAll('#rows tr');
    if (rows.length < 1) { msg.innerHTML="Tambah minimal satu isian!"; return; }

    let children = [
      new Paragraph({ children: [new TextRun({ text: "DAFTAR ELEMEN DAN CAPAIAN PEMBELAJARAN", bold: true, size: 30 })], alignment: AlignmentType.CENTER }),
      new Paragraph(""),
      new Paragraph("Nama Guru      : " + guru),
      new Paragraph("Kelas/Semester : " + kelas),
      new Paragraph("")
    ];

    let tRows = [
      new TableRow({
        children: [
          new TableCell({ children: [new Paragraph("No")], width: { size: 5, type: WidthType.PERCENTAGE } }),
          new TableCell({ children: [new Paragraph("Elemen")], width: { size: 25, type: WidthType.PERCENTAGE } }),
          new TableCell({ children: [new Paragraph("Capaian Pembelajaran")], width: { size: 35, type: WidthType.PERCENTAGE } }),
          new TableCell({ children: [new Paragraph("Deskripsi Elemen")], width: { size: 35, type: WidthType.PERCENTAGE } }),
        ]
      })
    ];
    let no=1;
    rows.forEach((r) => {
      const elemenIdx = r.querySelector("select").value;
      const elemenTxt = elemenIdx !== "" ? elOpt[elemenIdx] : "";
      const cpTxt = r.querySelector("textarea[id^='cp']").value;
      const descTxt = r.querySelector("textarea[id^='desc']").value;
      if (elemenTxt && cpTxt && descTxt) {
        tRows.push(
          new TableRow({
            children: [
              new TableCell({ children: [new Paragraph(String(no++))] }),
              new TableCell({ children: [new Paragraph(elemenTxt)] }),
              new TableCell({ children: [new Paragraph(cpTxt)] }),
              new TableCell({ children: [new Paragraph(descTxt)] })
            ]
          })
        );
      }
    });

    children.push(
      new Table({
        width: { size: 100, type: WidthType.PERCENTAGE },
        rows: tRows
      })
    );

    const doc = new Document({ sections: [{ children }] });
    const blob = await Packer.toBlob(doc);

    // Android Chrome/Samsung Internet: download dengan cara klik hidden <a>
    const a = document.createElement("a");
    a.style.display = "none";
    a.href = URL.createObjectURL(blob);
    a.download = "Elemen_CP_Agribisnis_Ternak.docx";
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 3000);
    document.body.removeChild(a);
    msg.innerHTML = "File berhasil diunduh, cek folder Download di perangkat Anda.";
  } catch (e) {
    msg.innerHTML = "Gagal membuat file Word. Pastikan pakai Chrome atau browser Android modern.";
  }
}
</script>
</body>
</html>