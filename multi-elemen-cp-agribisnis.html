<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Multi Isian Elemen & CP Agribisnis Ternak - Download Word</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 28px; background: #f8fafc;}
    .form-box { background: #fff; border-radius: 14px; box-shadow: 0 0 12px #eee; max-width: 900px; margin: auto; padding: 26px; }
    select, input, textarea { font-size: 1rem; padding: 6px; margin-top: 5px; border-radius: 7px; border: 1px solid #ddd; }
    label { font-weight: bold; margin-top: 16px; display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 18px; }
    th, td { border: 1px solid #cbd5e1; padding: 10px 7px; text-align: left; }
    th { background: #f1f5f9; }
    .btn-tambah, .btn-hapus, .btn-cetak { margin: 10px 3px 0 0; font-size: 1rem; border-radius: 8px; padding: 8px 13px; border: none;}
    .btn-tambah { background: #16a34a; color: #fff; }
    .btn-hapus { background: #ef4444; color: #fff; }
    .btn-cetak { background: #06b6d4; color: #fff; float: right; }
    @media (max-width: 650px) {
      .form-box { padding: 5vw; }
      table, th, td { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
<div class="form-box">
  <h2>Form Multi Isian Elemen & CP<br>Dasar-Dasar Agribisnis Ternak</h2>
  <label>Nama Guru:</label>
  <input id="guru" placeholder="Nama Guru" style="width:240px;">

  <label>Kelas/Semester:</label>
  <input id="kelas" placeholder="Kelas/Semester" style="width:180px;">

  <table id="tbl">
    <thead>
      <tr>
        <th style="width:45px;">No</th>
        <th style="width:260px;">Elemen</th>
        <th style="width:330px;">Capaian Pembelajaran</th>
        <th>Deskripsi Elemen</th>
        <th style="width:65px;">Aksi</th>
      </tr>
    </thead>
    <tbody id="rows">
    </tbody>
  </table>
  <button class="btn-tambah" type="button" onclick="addRow()">+ Tambah Baris</button>
  <button class="btn-cetak" type="button" onclick="cetakWord()">Download Word</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.4/docx.umd.min.js"></script>
<script>
const elOpt = [
  "Proses bisnis secara menyeluruh di bidang agribisnis ternak",
  "Perkembangan teknologi produksi & isu-isu global agribisnis ternak",
  "Agripreneur, peluang usaha & profesi di bidang agribisnis ternak",
  "Proses-proses dasar pada agribisnis ternak",
  "Penanganan komoditas peternakan sesuai prosedur K3LH"
];
const cp = [
  "Peserta didik mampu memahami aktivitas pekerjaan secara menyeluruh manajemen produksi bidang agribisnis ternak dengan memperhatikan potensi dan kearifan lokal.",
  "Peserta didik mampu memahami teknologi peternakan, isu-isu global terkait dengan agribisnis dan industri ternak.",
  "Peserta didik mampu memahami profil agripreneur dan peluang bekerja di bidang agribisnis ternak.",
  "Peserta didik mampu memahami konsep, prinsip, dan prosedur peternakan.",
  "Peserta didik mampu memahami pengidentifikasian karakteristik dan penanganan komoditas peternakan dengan menerapkan prinsip dan prosedur K3LH."
];
const desc = [
  "Meliputi aktivitas pekerjaan pada bidang agribisnis ternak, antara lain penerapan K3LH, perencanaan produk, rantai pasok (supply chain), logistik, proses produksi, penggunaan dan perawatan peralatan di bidang agribisnis ternak, serta pengelolaan sumber daya manusia dengan memperhatikan potensi dan kearifan lokal.",
  "Meliputi teknologi peternakan seperti perkembangan bioteknologi, otomatisasi, aplikasi digitalisasi dan internet of things (IoT), serta isu-isu pemanasan global, perubahan iklim, ketersediaan pangan global, regional dan lokal, pertanian berkelanjutan, sistem kelembagaan pada rantai produksi dan pasar, dan limbah dengan prinsip 8R (Rethink, Refuse, Reuse, Refurbish, Repair, Repurpose, Recycle).",
  "Meliputi profil agripreneur yang mampu membaca peluang pasar dan usaha, profesi pemroduksi ternak (petani ternak) dalam rangka menumbuhkan jiwa wirausaha, serta peluang usaha dan peluang bekerja di bidang agribisnis ternak.",
  "Meliputi konsep, prinsip dan prosedur peternakan (pembibitan, pakan, perkandangan, kesehatan ternak, pemeliharaan, pemanenan dan pemasaran).",
  "Meliputi pengidentifikasian karakteristik dan penanganan komoditas peternakan untuk disimpan, dikonsumsi, atau diproses lebih lanjut menjadi produk olahan setengah jadi, atau produk jadi dengan menerapkan prinsip dan prosedur K3LH."
];

let idxBaris = 0;

function makeDropdown(idx, selected) {
  let opt = `<select onchange="isiOtomatis(${idx})" style="width:250px;"><option value="">--Pilih--</option>`;
  for (let i=0; i<elOpt.length; i++) {
    opt += `<option value="${i}" ${selected==i?"selected":""}>${elOpt[i]}</option>`;
  }
  opt += "</select>";
  return opt;
}

function addRow(val=undefined) {
  idxBaris++;
  const tb = document.getElementById('rows');
  const tr = document.createElement('tr');
  tr.setAttribute('id','row'+idxBaris);

  tr.innerHTML =
    `<td style="text-align:center">${idxBaris}</td>
     <td>${makeDropdown(idxBaris, val)}</td>
     <td><textarea rows="3" readonly style="width:98%;resize:vertical;" id="cp${idxBaris}"></textarea></td>
     <td><textarea rows="3" readonly style="width:98%;resize:vertical;" id="desc${idxBaris}"></textarea></td>
     <td><button class="btn-hapus" type="button" onclick="delRow(${idxBaris})">Hapus</button></td>`;
  tb.appendChild(tr);
}

function isiOtomatis(idx) {
  const sel = document.querySelector(`#row${idx} select`);
  const v = sel.value;
  document.getElementById('cp'+idx).value = v!=="" ? cp[v] : "";
  document.getElementById('desc'+idx).value = v!=="" ? desc[v] : "";
}

function delRow(idx) {
  const r = document.getElementById('row'+idx);
  if (r) r.remove();
}

// Auto tambah satu baris saat awal
addRow();

async function cetakWord() {
  const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, HeadingLevel, AlignmentType } = window.docx;
  const guru = document.getElementById('guru').value;
  const kelas = document.getElementById('kelas').value;

  const rows = document.querySelectorAll('#rows tr');
  if (rows.length < 1) { alert('Tambah minimal satu isian!'); return; }

  // Judul dan identitas
  let children = [
    new Paragraph({ children: [new TextRun({ text: "DAFTAR ELEMEN DAN CAPAIAN PEMBELAJARAN", bold: true, size: 30 })], alignment: AlignmentType.CENTER }),
    new Paragraph(""),
    new Paragraph("Nama Guru      : " + guru),
    new Paragraph("Kelas/Semester : " + kelas),
    new Paragraph("")
  ];

  // Tabel data
  let tRows = [
    new TableRow({
      children: [
        new TableCell({ children: [new Paragraph("No")], width: { size: 5, type: WidthType.PERCENTAGE } }),
        new TableCell({ children: [new Paragraph("Elemen")], width: { size: 25, type: WidthType.PERCENTAGE } }),
        new TableCell({ children: [new Paragraph("Capaian Pembelajaran")], width: { size: 35, type: WidthType.PERCENTAGE } }),
        new TableCell({ children: [new Paragraph("Deskripsi Elemen")], width: { size: 35, type: WidthType.PERCENTAGE } }),
      ]
    })
  ];
  let no=1;
  rows.forEach((r) => {
    const idx = Array.from(r.parentNode.children).indexOf(r) + 1;
    const elemenIdx = r.querySelector("select").value;
    const elemenTxt = elemenIdx !== "" ? elOpt[elemenIdx] : "";
    const cpTxt = r.querySelector("textarea[id^='cp']").value;
    const descTxt = r.querySelector("textarea[id^='desc']").value;
    if (elemenTxt && cpTxt && descTxt) {
      tRows.push(
        new TableRow({
          children: [
            new TableCell({ children: [new Paragraph(String(no++))] }),
            new TableCell({ children: [new Paragraph(elemenTxt)] }),
            new TableCell({ children: [new Paragraph(cpTxt)] }),
            new TableCell({ children: [new Paragraph(descTxt)] })
          ]
        })
      );
    }
  });

  children.push(
    new Table({
      width: { size: 100, type: WidthType.PERCENTAGE },
      rows: tRows
    })
  );

  const doc = new Document({ sections: [{ children }] });

  const blob = await Packer.toBlob(doc);
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Elemen_CP_Agribisnis_Ternak.docx";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>
</body>
</html>